# í•œêµ­ì–´ ë¬¸ë²• ì „ë¬¸ê°€ AI ì±—ë´‡

import streamlit as st
import pandas as pd
import random
from py_hanspell.spell_checker import check as hanspell_check
from collections import Counter

# --- í•œêµ­ì–´ ë¬¸ë²• ê·œì¹™ ì „ë¬¸ê°€ DB (ì •í™•í•œ ë¬¸ë²• ì„¤ëª…) ---
GRAMMAR_RULES_DB = {
    "ë„ì–´ì“°ê¸°": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "ì¡°ì‚¬ì™€ ëª…ì‚¬ëŠ” ë„ì–´ ì“´ë‹¤",
                "ì„¤ëª…": "ì¡°ì‚¬(ì€/ëŠ”/ì´/ê°€/ì„/ë¥¼/ì—ê²Œ/ì—ì„œ ë“±)ëŠ” ì•žì˜ ëª…ì‚¬ì™€ ë¶™ì—¬ ì“°ê³ , ë‹¤ìŒ ë‹¨ì–´ì™€ëŠ” ë„ì–´ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë‚˜ëŠ”ë°¥ì„ë¨¹ì—ˆë‹¤ / ê·¸ê²ƒì„ë°›ì•˜ë‹¤",
                "ë§žëŠ”ì˜ˆ": "ë‚˜ëŠ” ë°¥ì„ ë¨¹ì—ˆë‹¤ / ê·¸ê²ƒì„ ë°›ì•˜ë‹¤"
            },
            {
                "ì›ì¹™": "ë³´ì¡°ë™ì‚¬ëŠ” ì•ž ë™ì‚¬ì™€ ë„ì–´ ì“´ë‹¤",
                "ì„¤ëª…": "ë³´ì¡°ë™ì‚¬(ìžˆë‹¤, ì—†ë‹¤, ëœë‹¤, ë†“ë‹¤ ë“±)ëŠ” ì•žì˜ ë™ì‚¬/í˜•ìš©ì‚¬ì™€ ë„ì–´ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "í•˜ê³ ì‹¶ë‹¤ / ê°€ê³ ì‹¶ì—ˆë‹¤ / ë¨¹ê³ ì‹¶ì–´",
                "ë§žëŠ”ì˜ˆ": "í•˜ê³  ì‹¶ë‹¤ / ê°€ê³  ì‹¶ì—ˆë‹¤ / ë¨¹ê³  ì‹¶ì–´"
            },
            {
                "ì›ì¹™": "ë¶€ì‚¬ì™€ ì„œìˆ ì–´ëŠ” ë„ì–´ ì“´ë‹¤",
                "ì„¤ëª…": "ë¶€ì‚¬(ì •ë§, ìžì£¼, ê¼­, ë‹¤ì‹œ ë“±)ëŠ” ë’¤ì˜ ì„œìˆ ì–´ì™€ ë„ì–´ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì •ë§ì¢‹ë‹¤ / ìžì£¼ê°„ë‹¤ / ê¼­ë´ì•¼í•œë‹¤",
                "ë§žëŠ”ì˜ˆ": "ì •ë§ ì¢‹ë‹¤ / ìžì£¼ ê°„ë‹¤ / ê¼­ ë´ì•¼ í•œë‹¤"
            },
            {
                "ì›ì¹™": "'-ã„¹ ìˆ˜ ìžˆë‹¤/ì—†ë‹¤/ìžˆì—ˆë‹¤'ëŠ” ë„ì–´ ì“´ë‹¤",
                "ì„¤ëª…": "ê°€ëŠ¥/ë¶ˆê°€ëŠ¥ í‘œí˜„ì—ì„œ 'ìˆ˜'ëŠ” ë…ë¦½ì ì¸ ëª…ì‚¬ì´ë¯€ë¡œ ë„ì–´ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "í• ìˆ˜ìžˆë‹¤ / ê°€ì§€ì•Šì„ìˆ˜ë„ìžˆì—ˆë‹¤",
                "ë§žëŠ”ì˜ˆ": "í•  ìˆ˜ ìžˆë‹¤ / ê°€ì§€ ì•Šì„ ìˆ˜ë„ ìžˆì—ˆë‹¤"
            },
            {
                "ì›ì¹™": "'ê²ƒ', 'ìˆ˜' ë“± ì˜ì¡´ëª…ì‚¬ëŠ” ë„ì–´ ì“´ë‹¤",
                "ì„¤ëª…": "ì˜ì¡´ëª…ì‚¬ëŠ” ì•ž ë‹¨ì–´ì™€ ë„ì–´ ì“´ë‹¤. ì˜ˆ: ê²ƒ, ìˆ˜, ë°”, ë“¯, ë§Œí¼, ê³³",
                "í‹€ë¦°ì˜ˆ": "ë¨¹ëŠ”ê²ƒì´ì¢‹ë‹¤ / ë‹¬ë¦¬ëŠ”ìˆ˜ë„ìžˆë‹¤",
                "ë§žëŠ”ì˜ˆ": "ë¨¹ëŠ” ê²ƒì´ ì¢‹ë‹¤ / ë‹¬ë¦¬ëŠ” ìˆ˜ë„ ìžˆë‹¤"
            },
            {
                "ì›ì¹™": "ì—°ê²°ì–´ë¯¸ '-ê³ , -ì§€ë§Œ, -ìœ¼ë¡œ' ë“±ì€ ë¶™ì—¬ ì“´ë‹¤",
                "ì„¤ëª…": "ë™ì‚¬ì™€ í˜•ìš©ì‚¬ ë’¤ì˜ ì—°ê²°ì–´ë¯¸ëŠ” ë¶™ì—¬ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë¨¹ ê³  ê°€ë‹¤ / í¬ ì§€ë§Œ ì˜ˆì˜ë‹¤",
                "ë§žëŠ”ì˜ˆ": "ë¨¹ê³  ê°€ë‹¤ / í¬ì§€ë§Œ ì˜ˆì˜ë‹¤"
            }
        ]
    },
    
    "ë†’ìž„ë§_ê²½ì–´": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "'ë˜ë‹¤'ì˜ ë†’ìž„ì€ 'ë˜ì‹œë‹¤'",
                "ì„¤ëª…": "'ë˜ë‹¤'ëŠ” ë†’ìž„í‘œí˜„ì´ ë¶ˆê·œì¹™ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œëŠ” 'ë˜ë‹¤'ì´ì§€ë§Œ, ë†’ìž„ì„ ë‚˜íƒ€ë‚¼ ë•ŒëŠ” 'ë˜ì‹œë‹¤'ë¡œ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì•„ë²„ì§€ê°€ ì˜ì‚¬ë˜ì…¨ì–´ìš”(Ã—)",
                "ë§žëŠ”ì˜ˆ": "ì•„ë²„ì§€ê°€ ì˜ì‚¬ê°€ ë˜ì…¨ì–´ìš”(â—‹)"
            },
            {
                "ì›ì¹™": "'ìžˆë‹¤'ì˜ ë†’ìž„ì€ 'ê³„ì‹ ë‹¤/ìžˆìœ¼ì‹ ë‹¤'",
                "ì„¤ëª…": "'ìžˆë‹¤'ë¥¼ ë†’ì¼ ë•ŒëŠ” 'ê³„ì‹œë‹¤' ë˜ëŠ” 'ìžˆìœ¼ì‹ ë‹¤'ë¥¼ ì‚¬ìš©í•œë‹¤. ìœ„ì¹˜ë‚˜ ì¡´ìž¬ë¥¼ ë‚˜íƒ€ë‚¼ ë•ŒëŠ” 'ê³„ì‹œë‹¤'ë¥¼ ì“°ëŠ” ê²ƒì´ ë°”ëžŒì§í•˜ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "í• ë¨¸ë‹ˆê°€ ì§‘ì— ìžˆìœ¼ì…”ìš”(Ã—)",
                "ë§žëŠ”ì˜ˆ": "í• ë¨¸ë‹ˆê°€ ì§‘ì— ê³„ì„¸ìš”(â—‹)"
            },
            {
                "ì›ì¹™": "'ë¨¹ë‹¤/ìžë‹¤'ì˜ ë†’ìž„ì€ 'ë“œì‹œë‹¤/ì£¼ë¬´ì‹œë‹¤'",
                "ì„¤ëª…": "ìŒì‹ ê´€ë ¨ 'ë¨¹ë‹¤'ëŠ” 'ë“œì‹œë‹¤', ìˆ˜ë©´ ê´€ë ¨ 'ìžë‹¤'ëŠ” 'ì£¼ë¬´ì‹œë‹¤'ë¡œ ë†’ì¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "í• ë¨¸ë‹ˆê°€ ë°¥ì„ ë¨¹ìœ¼ì„¸ìš” / í• ì•„ë²„ì§€ê°€ ìžì„¸ìš”",
                "ë§žëŠ”ì˜ˆ": "í• ë¨¸ë‹ˆê°€ ë°¥ì„ ë“œì„¸ìš” / í• ì•„ë²„ì§€ê°€ ì£¼ë¬´ì„¸ìš”"
            },
            {
                "ì›ì¹™": "'-ì„¸ìš”'ì™€ '-ìœ¼ì„¸ìš”'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "ëª¨ìŒìœ¼ë¡œ ëë‚˜ëŠ” ì–´ê°„ì€ '-ì„¸ìš”', ìžìŒìœ¼ë¡œ ëë‚˜ëŠ” ì–´ê°„ì€ '-ìœ¼ì„¸ìš”'ë¥¼ ë¶™ì¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ê°€ì„¸ìš”(Ã—) / ë¨¹ì„¸ìš”(Ã—)",
                "ë§žëŠ”ì˜ˆ": "ê°€ì…”ìš” ë˜ëŠ” ê°€ì„¸ìš” / ë¨¹ìœ¼ì„¸ìš”"
            }
        ]
    },

    "ì‹œì œ_ê³¼ê±°í˜•": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "'-ì•˜ëŠ”ë°'ì™€ '-ì•˜ì—ˆëŠ”ë°'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'-ì•˜ëŠ”ë°'ëŠ” ë§‰ ëë‚œ ê³¼ê±°, '-ì•˜ì—ˆëŠ”ë°'ëŠ” ë” ë¨¼ ê³¼ê±°ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "3ë…„ ì „ì— ê·¸ê³³ì— ê°”ëŠ”ë°...",
                "ë§žëŠ”ì˜ˆ": "3ë…„ ì „ì— ê·¸ê³³ì— ê°”ì—ˆëŠ”ë°..."
            },
            {
                "ì›ì¹™": "í˜„ìž¬ì§„í–‰ '-ê³  ìžˆë‹¤'ì˜ ì“°ìž„",
                "ì„¤ëª…": "í˜„ìž¬ ì§„í–‰ ì¤‘ì¸ í–‰ë™ì„ ë‚˜íƒ€ë‚¼ ë•ŒëŠ” '-ê³  ìžˆë‹¤'ë¥¼ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì €ëŠ” ê³µë¶€í•œë‹¤ (í˜„ìž¬ ì§„í–‰ ì¤‘ì´ë©´ í‹€ë¦¼)",
                "ë§žëŠ”ì˜ˆ": "ì €ëŠ” ì§€ê¸ˆ ê³µë¶€í•˜ê³  ìžˆë‹¤"
            },
            {
                "ì›ì¹™": "'-ì—ˆë˜'ê³¼ '-ì€'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'-ì—ˆë˜'ì€ ê³¼ê±°ì˜ ì¼ì„ íšŒìƒí•  ë•Œ, '-ì€'ì€ ì™„ë£Œëœ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì–´ë¦° ì‹œì ˆì—ëŠ” ë†€ì•˜ë˜ ì¶”ì–µì´ ë§Žë‹¤",
                "ë§žëŠ”ì˜ˆ": "ì–´ë¦° ì‹œì ˆì— ë†€ì•˜ë˜ ì¶”ì–µì´ ë§Žë‹¤"
            }
        ]
    },

    "ì£¼ê²©_ëª©ì ê²©_ì¡°ì‚¬": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "ì£¼ì–´ëŠ” 'ì´/ê°€', ëª©ì ì–´ëŠ” 'ì„/ë¥¼' ë°›ëŠ”ë‹¤",
                "ì„¤ëª…": "ë¬¸ìž¥ì˜ ì£¼ì–´(ë™ìž‘ì˜ ì£¼ì²´)ëŠ” 'ì´/ê°€' ì¡°ì‚¬ë¥¼ ë°›ê³ , ëª©ì ì–´(ë™ìž‘ì˜ ëŒ€ìƒ)ëŠ” 'ì„/ë¥¼' ì¡°ì‚¬ë¥¼ ë°›ëŠ”ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë‚˜ê°€ ì±…ì„ ì½ì—ˆë‹¤ / ì±…ì´ ì½ì—ˆë‹¤",
                "ë§žëŠ”ì˜ˆ": "ë‚´ê°€ ì±…ì„ ì½ì—ˆë‹¤ / ì±…ì„ ì½ì—ˆë‹¤"
            },
            {
                "ì›ì¹™": "ì‹œê°„ í‘œí˜„ì€ 'ì—' ì¡°ì‚¬ë¥¼ ì“´ë‹¤",
                "ì„¤ëª…": "êµ¬ì²´ì ì¸ ì‹œê°„(ë‚ ì§œ, ì‹œê°„) í‘œí˜„ ë’¤ì—ëŠ” 'ì—' ì¡°ì‚¬ë¥¼ ë¶™ì¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "3ì‹œê°„ì— ê³µë¶€í–ˆë‹¤ / ì›”ìš”ì¼ì„ ë§Œë‚¬ë‹¤",
                "ë§žëŠ”ì˜ˆ": "3ì‹œê°„ ê³µë¶€í–ˆë‹¤ / ì›”ìš”ì¼ì— ë§Œë‚¬ë‹¤"
            },
            {
                "ì›ì¹™": "ìž¥ì†ŒëŠ” 'ì—/ì—ì„œ' ì¤‘ ì„ íƒí•œë‹¤",
                "ì„¤ëª…": "ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚¼ ë•ŒëŠ” 'ì—', ë™ìž‘ì´ ì¼ì–´ë‚˜ëŠ” ê³³ì€ 'ì—ì„œ'ë¥¼ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì§‘ì—ì„œ ìžˆë‹¤ / í•™êµì— ê³µë¶€í•œë‹¤",
                "ë§žëŠ”ì˜ˆ": "ì§‘ì— ìžˆë‹¤ / í•™êµì—ì„œ ê³µë¶€í•œë‹¤"
            },
            {
                "ì›ì¹™": "'ì´/ê°€'ì™€ 'ì€/ëŠ”'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'ì´/ê°€'ëŠ” ìƒˆë¡œìš´ ì •ë³´, 'ì€/ëŠ”'ì€ ì´ë¯¸ ì•Œë ¤ì§„ ì •ë³´ë‚˜ ëŒ€ë¹„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ëˆ„ê°€ ì™”ì–´? ì² ìˆ˜ê°€ ì™”ì–´(ì´ì „ì— ì–¸ê¸‰ë˜ì—ˆìœ¼ë©´ ì–´ìƒ‰í•¨)",
                "ë§žëŠ”ì˜ˆ": "ëˆ„ê°€ ì™”ì–´? ì² ìˆ˜ëŠ” ì™”ì–´"
            }
        ]
    },

    "ë¬¸ë²•ì _ì¼ê´€ì„±": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "ì£¼ìˆ  í˜¸ì‘ì„ ë§žì¶˜ë‹¤",
                "ì„¤ëª…": "ì£¼ì–´ì™€ ìˆ ì–´ê°€ ë¬¸ë²•ì ìœ¼ë¡œ ë§žì•„ë–¨ì–´ì ¸ì•¼ í•œë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì´ ë¬¸ì œì˜ ë‹µì€ ì–´ë µë‹¤",
                "ë§žëŠ”ì˜ˆ": "ì´ ë¬¸ì œëŠ” ì–´ë µë‹¤ / ì´ ë¬¸ì œì˜ ë‹µì€ ê°„ë‹¨í•˜ë‹¤"
            },
            {
                "ì›ì¹™": "ëª©ì ì–´ì™€ ìˆ ì–´ì˜ í˜¸ì‘",
                "ì„¤ëª…": "ëª©ì ì–´ê°€ ë°›ì„ ìˆ˜ ìžˆëŠ” ë™ì‚¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë°¥ì„ ë§ˆì‹ ë‹¤",
                "ë§žëŠ”ì˜ˆ": "ë°¥ì„ ë¨¹ëŠ”ë‹¤ / ë¬¼ì„ ë§ˆì‹ ë‹¤"
            },
            {
                "ì›ì¹™": "ìˆ˜ì‹ì–´ì™€ ìˆ˜ì‹ë°›ëŠ” ë§ì˜ í˜¸ì‘",
                "ì„¤ëª…": "í˜•ìš©ì‚¬ë‚˜ ê´€í˜•ì‚¬ëŠ” ë’¤ì— ì˜¤ëŠ” ëª…ì‚¬ì™€ ì˜ë¯¸ìƒ ì–´ìš¸ë ¤ì•¼ í•œë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë¹ ë¥¸ ê²½í—˜ì„ í–ˆë‹¤",
                "ë§žëŠ”ì˜ˆ": "ë¹ ë¥¸ ì†ë„ë¡œ ë‹¬ë ¸ë‹¤ / ìƒˆë¡œìš´ ê²½í—˜ì„ í–ˆë‹¤"
            }
        ]
    },

    "ë°œìŒ_í‘œê¸°ë²•": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "'-ã…‚ë‹ˆë‹¤'ì™€ '-ìŠµë‹ˆë‹¤'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "ì–´ê°„ì´ ëª¨ìŒìœ¼ë¡œ ëë‚˜ë©´ '-ã…‚ë‹ˆë‹¤', ìžìŒìœ¼ë¡œ ëë‚˜ë©´ '-ìŠµë‹ˆë‹¤'ë¥¼ ë¶™ì¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë¨¹ìŠµë‹ˆë‹¤(Ã—) / ì˜¤ã…‚ë‹ˆë‹¤(Ã—)",
                "ë§žëŠ”ì˜ˆ": "ë¨¹ìŠµë‹ˆë‹¤(â—‹) / ì˜µë‹ˆë‹¤(â—‹)"
            },
            {
                "ì›ì¹™": "ã„±/ã„²ì˜ ë°œìŒ êµ¬ë¶„",
                "ì„¤ëª…": "'ì˜³ë‹¤'ëŠ” 'ã„·' ë°›ì¹¨ì´ë¯€ë¡œ ì˜³ì€(ì˜³'+ì€')",
                "í‹€ë¦°ì˜ˆ": "ì˜¬ë°”ë¥´ë‹¤(Ã—)",
                "ë§žëŠ”ì˜ˆ": "ì˜³ë‹¤(â—‹) / ê¼­(â—‹)"
            },
            {
                "ì›ì¹™": "'-ã„¹'ì˜ ë°œìŒê³¼ í‘œê¸°",
                "ì„¤ëª…": "ë¯¸ëž˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” '-ã„¹'ì€ '-ì„'ê³¼ êµ¬ë¶„í•´ì•¼ í•œë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë¨¹ì„ ê²ƒì´ë‹¤(ë¯¸ëž˜ì¼ ë•Œ)",
                "ë§žëŠ”ì˜ˆ": "ë¨¹ì„ ê²ƒì´ë‹¤(ê³¼ê±°) / ë¨¹ì„ ê±°ë‹¤(ë¯¸ëž˜)"
            }
        ]
    },

    "ìžì£¼_í‹€ë¦¬ëŠ”_í‘œí˜„ë“¤": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "'ëœ»ë°–ì—'ëŠ” ì˜ˆìƒ ë°–ì˜ ì˜ë¯¸",
                "ì„¤ëª…": "'ëœ»ë°–ì—'ëŠ” ë¶€ì‚¬ë¡œ ì˜ˆìƒí•˜ì§€ ëª»í•œ ê²°ê³¼ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ëœ»ë°–ì— ì¢‹ì•˜ë‹¤(ì–´ìƒ‰í•¨)",
                "ë§žëŠ”ì˜ˆ": "ëœ»ë°–ì—ë„ ì¢‹ì•˜ë‹¤ / ì˜ˆìƒ ë°–ìœ¼ë¡œ ì¢‹ì•˜ë‹¤"
            },
            {
                "ì›ì¹™": "'ëª‡'ê³¼ 'ëª‡ ê°œ'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'ëª‡'ì€ ë‹¨ë…ìœ¼ë¡œ ì“¸ ìˆ˜ ì—†ê³  ë’¤ì— ëª…ì‚¬ë‚˜ ë‹¨ìœ„ë¥¼ ë¶™ì—¬ì•¼ í•œë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ëª‡ì´ ë‚¨ì•˜ì–´?",
                "ë§žëŠ”ì˜ˆ": "ëª‡ ê°œê°€ ë‚¨ì•˜ì–´? / ëª‡ ëª…ì´ ì™”ì–´?"
            },
            {
                "ì›ì¹™": "'ë‹¤ë¥¸'ê³¼ 'ë‹¬ë¦¬'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'ë‹¤ë¥¸'ì€ í˜•ìš©ì‚¬, 'ë‹¬ë¦¬'ëŠ” ë¶€ì‚¬ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë‹¤ë¥´ê²Œ ìƒê°í•œë‹¤(í‹€ë¦¼)",
                "ë§žëŠ”ì˜ˆ": "ë‹¤ë¥´ê²Œ ìƒê°í•œë‹¤(â—‹) / ë‹¬ë¦¬ ìƒê°í•´ë³´ìž(â—‹)"
            },
            {
                "ì›ì¹™": "'ê°™ì´'ì™€ 'ê°™ê²Œ'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'ê°™ì´'ëŠ” í•¨ê»˜, 'ê°™ê²Œ'ëŠ” ëª¨ì–‘ì´ ê°™ë‹¤ëŠ” ëœ»ì´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë‚˜ê°™ê²Œ í•´ì¤˜",
                "ë§žëŠ”ì˜ˆ": "ë‚˜ì²˜ëŸ¼ í•´ì¤˜ / ìš°ë¦¬ëŠ” ìƒê°ì´ ê°™ì•„ì•¼ í•œë‹¤"
            }
        ]
    },

    "ì¢…ì„±_ë°›ì¹¨_í‘œí˜„": {
        "ê·œì¹™": [
            {
                "ì›ì¹™": "'ì´ì—ìš”'ì™€ 'ì˜ˆìš”'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "ë°›ì¹¨ì´ ìžˆëŠ” ëª…ì‚¬ ë’¤ì—ëŠ” 'ì´ì—ìš”', ë°›ì¹¨ì´ ì—†ëŠ” ëª…ì‚¬ ë’¤ì—ëŠ” 'ì˜ˆìš”'ë¥¼ ë¶™ì¸ë‹¤. ë‹¨, 'ì•„ë‹ˆë‹¤'ëŠ” ì˜ˆì™¸ë¡œ í•­ìƒ 'ì•„ë‹ˆì—ìš”'ë¥¼ ì“´ë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì €ëŠ” í•™ìƒì˜ˆìš”. / ì•„ë‹ˆì˜ˆìš”, ê´œì°®ì•„ìš”.",
                "ë§žëŠ”ì˜ˆ": "ì €ëŠ” í•™ìƒì´ì—ìš”. / ì•„ë‹ˆì—ìš”, ê´œì°®ì•„ìš”."
            },
            {
                "ì›ì¹™": "'ë˜'ì™€ 'ë¼'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'ë¼'ëŠ” 'ë˜ì–´'ì˜ ì¤€ë§ë¡œ, 'í•´'ë¡œ ë°”ê¿¨ì„ ë•Œ ë§ì´ ë˜ë©´ 'ë¼'ë¥¼ ì“´ë‹¤. 'ë˜'ëŠ” 'í•˜'ë¡œ ë°”ê¿¨ì„ ë•Œ ë§ì´ ë˜ë©´ 'ë˜'ë¥¼ ì“´ë‹¤. í™•ì¸ ë°©ë²•: 'ì•ˆ ë¼' â†’ 'ì•ˆ í•´' (O), 'ì„ ìƒë‹˜ì´ ë¼' â†’ 'ì„ ìƒë‹˜ì´ í•´' (X ì–´ìƒ‰í•¨, 'ë˜' ì‚¬ìš©)",
                "í‹€ë¦°ì˜ˆ": "ê·¸ëŸ¬ë©´ ì•ˆë˜. / ì˜ì‚¬ê°€ ë¼ê³  ì‹¶ì–´ìš”.",
                "ë§žëŠ”ì˜ˆ": "ê·¸ëŸ¬ë©´ ì•ˆë¼. / ì˜ì‚¬ê°€ ë˜ê³  ì‹¶ì–´ìš”."
            },
            {
                "ì›ì¹™": "'ì–´ë–¡í•´'ì™€ 'ì–´ë–»ê²Œ'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'ì–´ë–¡í•´'ëŠ” 'ì–´ë–»ê²Œ í•´'ì˜ ì¤€ë§ë¡œ ê±±ì •ë˜ê±°ë‚˜ ë‚œê°í•œ ìƒí™©ì—ì„œ ì‚¬ìš©í•œë‹¤. 'ì–´ë–»ê²Œ'ëŠ” ë°©ë²•ì„ ë¬¼ì„ ë•Œ ì‚¬ìš©í•œë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ì–´ë–¡í•´ ë‚˜í•œí…Œ ê·¸ëŸ´ ìˆ˜ ìžˆì–´? / ì§€ê°‘ì„ ìžƒì–´ë²„ë ¸ì–´. ì–´ë–»ê²Œ!",
                "ë§žëŠ”ì˜ˆ": "ì–´ë–»ê²Œ ë‚˜í•œí…Œ ê·¸ëŸ´ ìˆ˜ ìžˆì–´? / ì§€ê°‘ì„ ìžƒì–´ë²„ë ¸ì–´. ì–´ë–¡í•´!"
            },
            {
                "ì›ì¹™": "'ì•ˆ'ê³¼ 'ì•Š'ì˜ êµ¬ë¶„",
                "ì„¤ëª…": "'ì•ˆ'ì€ ë¶€ì‚¬ë¡œ ë™ì‚¬/í˜•ìš©ì‚¬ ì•žì— ì˜¤ë©°, 'ì•Š'ì€ ì–´ë¯¸ë¡œ ë™ì‚¬/í˜•ìš©ì‚¬ ë’¤ì— ë¶™ëŠ”ë‹¤. 'ì•ˆ í•˜ë‹¤'ëŠ” 'ì•Šë‹¤', 'ì•Šë‹¤'ëŠ” 'í•˜ë‹¤'ì™€ ê²°í•©í•œë‹¤.",
                "í‹€ë¦°ì˜ˆ": "ë„ˆëŠ” ë‚˜í•œí…Œ ë¯¸ì•ˆí•˜ì§€ë„ ì•ˆë‹ˆ? / ìˆ™ì œë¥¼ ì•„ì§ ì•Š í–ˆë‹¤.",
                "ë§žëŠ”ì˜ˆ": "ë„ˆëŠ” ë‚˜í•œí…Œ ë¯¸ì•ˆí•˜ì§€ë„ ì•Šë‹ˆ? / ìˆ™ì œë¥¼ ì•„ì§ ì•ˆ í–ˆë‹¤."
            }
        ]
    }
}

def get_detailed_grammar_explanation(word_or_phrase: str) -> list:
    """ì£¼ì–´ì§„ ë‹¨ì–´ë‚˜ ë¬¸êµ¬ì— ëŒ€í•œ ì •í™•í•œ ë¬¸ë²• ì„¤ëª…ì„ ë°˜í™˜í•œë‹¤."""
    search_term = word_or_phrase.lower().strip()
    explanations = []
    
    for category, rules in GRAMMAR_RULES_DB.items():
        for rule in rules.get("ê·œì¹™", []):
            if (search_term in rule.get("í‹€ë¦°ì˜ˆ", "").lower() or
                search_term in rule.get("ë§žëŠ”ì˜ˆ", "").lower() or
                search_term in rule.get("ì„¤ëª…", "").lower()):
                explanations.append({
                    "ì¹´í…Œê³ ë¦¬": category,
                    "ì›ì¹™": rule.get("ì›ì¹™", ""),
                    "ì„¤ëª…": rule.get("ì„¤ëª…", ""),
                    "í‹€ë¦°ì˜ˆ": rule.get("í‹€ë¦°ì˜ˆ", ""),
                    "ë§žëŠ”ì˜ˆ": rule.get("ë§žëŠ”ì˜ˆ", "")
                })
    
    return explanations

# --- íŽ˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ---
st.set_page_config(
    page_title="ë§žì¶¤ë²• íƒí—˜ëŒ€ - ë¬¸ë²• ì „ë¬¸ê°€ AI",
    page_icon="ðŸ§­",
    layout="wide",
    initial_sidebar_state="auto",
)

# --- ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” ---
if 'errors' not in st.session_state:
    st.session_state.errors = []
if 'quiz_stats' not in st.session_state:
    st.session_state.quiz_stats = {'correct': 0, 'total': 0}
if 'current_quiz' not in st.session_state:
    st.session_state.current_quiz = None
if 'quiz_result' not in st.session_state:
    st.session_state.quiz_result = None

# --- ë©”ì¸ í™”ë©´ êµ¬ì„± ---
st.title("ðŸ§­ ë§žì¶¤ë²• íƒí—˜ëŒ€ - ë¬¸ë²• ì „ë¬¸ê°€ AI")
st.write("í—·ê°ˆë¦¬ëŠ” ë§žì¶¤ë²•ì„ ê²Œìž„ì²˜ëŸ¼ ë°°ìš°ê³ , ì •í™•í•œ ë¬¸ë²• ê·œì¹™ìœ¼ë¡œ ì‹¤ë ¥ì„ í‚¤ì›Œë³´ì•„ìš”!")

# --- ê¸°ëŠ¥ë³„ íƒ­ ìƒì„± ---
tab1, tab2, tab3, tab4, tab5 = st.tabs([
    "ðŸ–Šï¸ ë§ˆë²•ì˜ êµì • íŽœ",
    "ðŸ“’ ì˜¤ë‹µ ë…¸íŠ¸",
    "ðŸ† ë§žì¶¤ë²• í€´ì¦ˆ",
    "ðŸŒ³ í†µê³„",
    "ðŸ“š ë¬¸ë²• ê·œì¹™ ì‚¬ì „"
])

# --- ê¸°ëŠ¥ 1: ë§ˆë²•ì˜ êµì • íŽœ ---
with tab1:
    st.header("âœï¸ ë¬¸ìž¥ ì²¨ì‚­")
    st.markdown("ì •í™•í•œ ë¬¸ë²• ê·œì¹™ì— ê¸°ë°˜í•œ ì „ë¬¸ì ì¸ ì„¤ëª…ì„ ì œê³µí•©ë‹ˆë‹¤")
    
    sentence_input = st.text_area("ê²€ì‚¬í•˜ê³  ì‹¶ì€ ë¬¸ìž¥ì„ ìž…ë ¥í•˜ì„¸ìš”:", height=150)

    if st.button("ë§žì¶¤ë²• ê²€ì‚¬í•˜ê¸°", type="primary"):
        if sentence_input:
            with st.spinner("ë¶„ì„ ì¤‘..."):
                try:
                    spelled_sent = hanspell_check(sentence_input)
                    original_text = spelled_sent.original
                    corrected_text = spelled_sent.checked
                    
                    st.subheader("âœ¨ êµì • ê²°ê³¼")
                    col1, col2 = st.columns(2)
                    with col1:
                        st.text_input("ðŸ“ ì›ëž˜ ë¬¸ìž¥", original_text, disabled=True)
                    with col2:
                        st.text_input("âœ… ê³ ì¹œ ë¬¸ìž¥", corrected_text, disabled=True)

                    if spelled_sent.errors > 0:
                        st.info(f"ðŸ” {spelled_sent.errors}ê°œì˜ ë§žì¶¤ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì•˜ì–´ìš”!")
                        st.subheader("ðŸ“– ì˜¤ë¥˜ ë¶„ì„ & ë¬¸ë²• ì„¤ëª…")
                        
                        for original_word, error_info in spelled_sent.words.items():
                            error_type = error_info[0]
                            corrected_word = error_info[1]
                            
                            with st.expander(f"âŒ '{original_word}' â†’ âœ… '{corrected_word}'"):
                                st.markdown(f"**ì˜¤ë¥˜ ìœ í˜•**: `{error_type}`")
                                st.markdown(f"**ì˜¬ë°”ë¥¸ í‘œí˜„**: {corrected_word}")
                                
                                grammar_explanations = get_detailed_grammar_explanation(original_word)
                                
                                if grammar_explanations:
                                    st.markdown("**ðŸ“š ê´€ë ¨ ë¬¸ë²• ê·œì¹™**")
                                    for explanation in grammar_explanations:
                                        st.markdown(f"- **{explanation['ì›ì¹™']}**")
                                        st.markdown(f"  {explanation['ì„¤ëª…']}")
                                        st.markdown(f"  âŒ {explanation['í‹€ë¦°ì˜ˆ']}")
                                        st.markdown(f"  âœ… {explanation['ë§žëŠ”ì˜ˆ']}")
                            
                            st.session_state.errors.append({
                                "í‹€ë¦° ë‹¨ì–´": original_word,
                                "ë§žëŠ” ë‹¨ì–´": corrected_word,
                                "ì˜¤ë¥˜ ìœ í˜•": error_type
                            })
                        
                        st.success("âœ… ì˜¤ë¥˜ë¥¼ ì˜¤ë‹µ ë…¸íŠ¸ì— ê¸°ë¡í–ˆì–´ìš”!")
                    else:
                        st.success("ðŸŽ‰ ì™„ë²½í•œ ë¬¸ìž¥ì´ì—ìš”!")
                except Exception as e:
                    st.error(f"ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
        else:
            st.warning("ë¬¸ìž¥ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”!")

# --- ê¸°ëŠ¥ 2: ì˜¤ë‹µ ë…¸íŠ¸ ---
with tab2:
    st.header("ðŸ§ ìžì£¼ í‹€ë¦¬ëŠ” ë§žì¶¤ë²•")
    if st.session_state.errors:
        error_df = pd.DataFrame(st.session_state.errors)
        st.dataframe(error_df, use_container_width=True)

        st.subheader("ðŸ” ìžì£¼ í‹€ë¦¬ëŠ” ìœ í˜•")
        error_types = [error['ì˜¤ë¥˜ ìœ í˜•'] for error in st.session_state.errors]
        type_counts = Counter(error_types)
        st.bar_chart(pd.DataFrame.from_dict(type_counts, orient='index', columns=['íšŸìˆ˜']))

        if st.button("ë…¸íŠ¸ ë¹„ìš°ê¸°"):
            st.session_state.errors = []
            st.rerun()
    else:
        st.info("ì•„ì§ ê¸°ë¡ëœ ì˜¤ë‹µì´ ì—†ì–´ìš”!")

# --- ê¸°ëŠ¥ 3: ë§žì¶¤ë²• í€´ì¦ˆ ---
with tab3:
    st.header("ðŸ… ë§žì¶¤ë²• í€´ì¦ˆ")
    unique_errors = [dict(t) for t in {tuple(d.items()) for d in st.session_state.errors}]
    
    if len(unique_errors) >= 2:
        if st.button("ìƒˆë¡œìš´ í€´ì¦ˆ ì‹œìž‘!") or st.session_state.current_quiz:
            if not st.session_state.current_quiz:
                quiz_items = random.sample(unique_errors, 2)
                question_item = quiz_items[0]
                wrong_option_item = quiz_items[1]

                options = [question_item['ë§žëŠ” ë‹¨ì–´'], wrong_option_item['ë§žëŠ” ë‹¨ì–´']]
                random.shuffle(options)
                
                st.session_state.current_quiz = {
                    "question": f"'{question_item['í‹€ë¦° ë‹¨ì–´']}'ì˜ ì˜¬ë°”ë¥¸ í‘œí˜„ì€?",
                    "options": options,
                    "answer": question_item['ë§žëŠ” ë‹¨ì–´']
                }
                st.session_state.quiz_result = None

            quiz = st.session_state.current_quiz
            st.subheader(quiz['question'])
            user_answer = st.radio("ì •ë‹µ:", quiz['options'], index=None)

            if st.button("ì •ë‹µ í™•ì¸"):
                if user_answer:
                    st.session_state.quiz_stats['total'] += 1
                    if user_answer == quiz['answer']:
                        st.session_state.quiz_stats['correct'] += 1
                        st.session_state.quiz_result = "correct"
                        st.success("ì •ë‹µìž…ë‹ˆë‹¤! ðŸ‘")
                    else:
                        st.session_state.quiz_result = "incorrect"
                        st.error(f"ì˜¤ë‹µìž…ë‹ˆë‹¤. ì •ë‹µì€ '{quiz['answer']}'ì˜ˆìš”!")
                    
                    st.session_state.current_quiz = None
                else:
                    st.warning("ì •ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”!")
    else:
        st.info("í€´ì¦ˆë¥¼ ë§Œë“¤ë ¤ë©´ ì˜¤ë‹µ ë…¸íŠ¸ì— 2ê°œ ì´ìƒì˜ ì˜¤ë‹µì´ í•„ìš”í•´ìš”!")

# --- ê¸°ëŠ¥ 4: í†µê³„ ---
with tab4:
    st.header("ðŸ“Š í•™ìŠµ í†µê³„")
    total = st.session_state.quiz_stats['total']
    correct = st.session_state.quiz_stats['correct']

    if total > 0:
        accuracy = (correct / total) * 100
        st.subheader("ðŸŒ³ ì„±ìž¥ ë‚˜ë¬´")
        
        if accuracy < 30:
            st.write("ìƒˆì‹¹ ë‹¨ê³„ ðŸŒ±")
        elif accuracy < 70:
            st.write("ë‚˜ë¬´ ë‹¨ê³„ ðŸŒ³")
        else:
            st.write("ìˆ² ë‹¨ê³„ ðŸŒ²")

        col1, col2 = st.columns(2)
        col1.metric("í‘¼ í€´ì¦ˆ", f"{total}ê°œ")
        col2.metric("ì •ë‹µë¥ ", f"{accuracy:.1f}%")
        st.progress(accuracy / 100)
    else:
        st.info("í€´ì¦ˆë¥¼ í’€ë©´ í†µê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìžˆì–´ìš”!")

# --- ê¸°ëŠ¥ 5: ë¬¸ë²• ê·œì¹™ ì‚¬ì „ ---
with tab5:
    st.header("ðŸ“š í•œêµ­ì–´ ë¬¸ë²• ê·œì¹™ ì‚¬ì „")
    st.markdown("ì •í™•í•œ í•œêµ­ì–´ ë¬¸ë²• ê·œì¹™ì„ í•™ìŠµí•˜ì„¸ìš”.")
    
    selected_category = st.selectbox(
        "í•™ìŠµ ì¹´í…Œê³ ë¦¬:",
        list(GRAMMAR_RULES_DB.keys())
    )
    
    if selected_category in GRAMMAR_RULES_DB:
        category_rules = GRAMMAR_RULES_DB[selected_category]
        st.subheader(f"ðŸŽ¯ {selected_category}")
        
        for idx, rule in enumerate(category_rules.get("ê·œì¹™", []), 1):
            with st.expander(f"{idx}. {rule.get('ì›ì¹™')}"):
                st.markdown(f"**ì„¤ëª…**: {rule.get('ì„¤ëª…')}")
                st.error(f"âŒ í‹€ë¦° ì˜ˆ: {rule.get('í‹€ë¦°ì˜ˆ')}")
                st.success(f"âœ… ë§žëŠ” ì˜ˆ: {rule.get('ë§žëŠ”ì˜ˆ')}")
    
    st.markdown("---")
    st.subheader("ðŸ” ê·œì¹™ ê²€ìƒ‰")
    search_keyword = st.text_input("ê²€ìƒ‰ í‚¤ì›Œë“œ (ì˜ˆ: ë„ì–´ì“°ê¸°, ì¡°ì‚¬, ì‹œì œ):")
    
    if search_keyword:
        results = get_detailed_grammar_explanation(search_keyword)
        if results:
            st.success(f"'{search_keyword}'ê³¼ ê´€ë ¨ëœ {len(results)}ê°œ ê·œì¹™")
            for result in results:
                with st.expander(f"{result['ì¹´í…Œê³ ë¦¬']} - {result['ì›ì¹™']}"):
                    st.write(f"**ì„¤ëª…**: {result['ì„¤ëª…']}")
                    st.error(f"âŒ {result['í‹€ë¦°ì˜ˆ']}")
                    st.success(f"âœ… {result['ë§žëŠ”ì˜ˆ']}")
        else:
            st.info("ê´€ë ¨ ê·œì¹™ì„ ì°¾ì§€ ëª»í–ˆì–´ìš”!")
    
    st.markdown("---")
    st.info("""
    **í•œêµ­ì–´ ë¬¸ë²• 5ê°€ì§€ í•µì‹¬:**
    1. ë„ì–´ì“°ê¸° - ì¡°ì‚¬, ë³´ì¡°ë™ì‚¬, ë¶€ì‚¬ì™€ ì„œìˆ ì–´ëŠ” ë„ì–´ì“°ê¸°
    2. ë†’ìž„ë§ - ìƒí™©ì— ë§žëŠ” ì˜¬ë°”ë¥¸ ë†’ìž„ í‘œí˜„
    3. ì‹œì œ - ì‹œê°„ ê´€ê³„ë¥¼ ì •í™•ížˆ ë‚˜íƒ€ë‚´ê¸°
    4. ì¡°ì‚¬ - ëª…ì‚¬ì˜ ì—­í• ì— ë§žëŠ” ì¡°ì‚¬ ì„ íƒ
    5. ì£¼ìˆ  í˜¸ì‘ - ì£¼ì–´ì™€ ìˆ ì–´ì˜ ë¬¸ë²•ì  ì¼ì¹˜
    """)
